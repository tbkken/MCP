# MCP服务管理器数据模型

## 概述
本项目使用SQLite数据库存储MCP服务配置信息，通过JPA（Java Persistence API）进行数据访问。数据模型包含两个核心实体：McpServer（MCP服务）和McpTool（MCP工具）。

## McpServer实体

### 表结构
- **表名**：mcp_servers
- **关联表**：mcp_server_headers（存储请求头信息）

### 字段说明
| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | Long | 主键，自增 | 服务唯一标识符 |
| name | String | 非空，唯一 | 服务名称 |
| type | String | 非空 | 服务类型（"sse" 或 "http"） |
| url | String | 非空 | 服务URL地址 |
| timeout | Integer | 可空 | 超时时间（秒） |
| headers | Map<String, String> | 可空 | 请求头键值对 |

### 关联表 mcp_server_headers
| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| server_id | Long | 外键 | 关联的MCP服务ID |
| header_key | String | 主键 | 请求头键 |
| header_value | String | 无 | 请求头值 |

### Java实体类定义
```java
@Entity
@Table(name = "mcp_servers")
public class McpServer {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true)
    private String name;

    @Column(nullable = false)
    private String type;

    @Column(nullable = false)
    private String url;

    @Column
    private Integer timeout;

    @ElementCollection
    @CollectionTable(name = "mcp_server_headers", joinColumns = @JoinColumn(name = "server_id"))
    @MapKeyColumn(name = "header_key")
    @Column(name = "header_value")
    private Map<String, String> headers;
    
    // 构造函数、Getter和Setter方法...
}
```

## McpTool实体

### 说明
McpTool实体用于表示从MCP服务器获取的工具信息，不直接持久化到数据库中，仅在运行时使用。

### 字段说明
| 字段名 | 类型 | 描述 |
|--------|------|------|
| name | String | 工具名称 |
| description | String | 工具描述 |
| inputSchema | JsonSchema | 输入参数模式（JSON Schema格式） |
| outputSchema | Map<String, Object> | 输出结果模式（JSON对象） |

### Java实体类定义
```java
public class McpTool {
    private String name;
    private String description;
    private JsonSchema inputSchema;
    private Map<String, Object> outputSchema;
    
    // 构造函数、Getter和Setter方法...
}
```

## 数据访问层

### McpServerRepository接口
```java
@Repository
public interface McpServerRepository extends JpaRepository<McpServer, Long> {
    Optional<McpServer> findByName(String name);
    boolean existsByName(String name);
}
```

### 支持的数据库操作
- `findAll()`：获取所有MCP服务
- `findById(Long id)`：根据ID查找MCP服务
- `save(McpServer server)`：保存或更新MCP服务
- `deleteById(Long id)`：根据ID删除MCP服务
- `findByName(String name)`：根据名称查找MCP服务
- `existsByName(String name)`：检查服务名称是否存在

## 数据库配置
在`application.properties`中配置：
```properties
spring.datasource.url=jdbc:sqlite:mcp.db
spring.datasource.driver-class-name=org.sqlite.JDBC
spring.datasource.username=
spring.datasource.password=
spring.jpa.database-platform=org.sqlite.hibernate.dialect.SQLiteDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
```

## 数据持久化策略
- 使用SQLite嵌入式数据库，数据存储在`mcp.db`文件中
- 启用自动DDL更新（`ddl-auto=update`），表结构会自动创建和更新
- 启用SQL日志输出（`show-sql=true`），便于调试
